import{sa as f}from"/build-v1/_shared/chunk-KSDHKFAK.js";import{a as u}from"/build-v1/_shared/chunk-JN6KKRJY.js";import{a as s}from"/build-v1/_shared/chunk-765QR4H3.js";import{H as g,q as m}from"/build-v1/_shared/chunk-YRXIICRT.js";import{y as d}from"/build-v1/_shared/chunk-N64KLDO5.js";import{a as I}from"/build-v1/_shared/chunk-C6G2CU7L.js";import{e as p}from"/build-v1/_shared/chunk-Y24IREY5.js";var i=p(I());g();function h(){(function(){let e=window,t=e.Intercom;if(typeof t=="function")t("reattach_activator"),t("update",e.intercomSettings);else{let n=document,r=function(){r.c(arguments)};r.q=[],r.c=function(c){r.q.push(c)},e.Intercom=r;let o=function(){let c=n.createElement("script");c.type="text/javascript",c.async=!0,c.src=`https://widget.intercom.io/widget/${s.intercomAppId}`;let a=n.getElementsByTagName("script")[0];a.parentNode.insertBefore(c,a)};document.readyState==="complete"?o():e.attachEvent?e.attachEvent("onload",o):e.addEventListener("load",o,!1)}})()}var l=(0,i.createContext)({isInjected:!1,Intercom:null});function y(){return(0,i.useContext)(l)}var x=u(({children:e})=>{let{account:t}=f(),[n,r]=(0,i.useState)(!1);(0,i.useEffect)(()=>{!t.isSignedIn||n||(h(),r(!0))},[t.isSignedIn,n]),(0,i.useEffect)(()=>{if(!n)return;let a=t.user;a?Intercom("boot",{app_id:`${s.intercomAppId}`,name:a.displayName||void 0,email:a.email||void 0,created_at:a.metadata.creationTime?new Date(a.metadata.creationTime).getTime()/1e3:void 0}):a||Intercom("shutdown"),Intercom("update",{hide_default_launcher:!0})},[t.user,n]),t.hasLoaded&&(t.team.loaded||t.team.load(),_(t));let o=m();(0,i.useEffect)(()=>{!n||(o.pathname!=="/account"&&Intercom&&Intercom("update",{hide_default_launcher:!0}),Intercom&&Intercom("update"))},[o,n]);let c={isInjected:n,Intercom:n?window.Intercom:null};return d(l.Provider,{value:c,children:e})});function C(e=!0){let{Intercom:t}=y();(0,i.useEffect)(()=>{function n(r){!t||t("update",{hide_default_launcher:!r})}return n(e),()=>{e&&n(!1)}},[e,t])}function _(e){let t={num_codes:e.mycodes.size,num_vcard:e.numVCard,num_domains:e.domains.domains.length};e&&e.billing.subscription&&(t.currency=e.billing.subscription?.paddleSubscription?.last_payment.currency,e.team.loaded&&e.team&&(t.team_id=e.team.org?.id,t.num_users=e.team.orgMembers?.length)),Intercom("update",t);var n=new Date(Date.now());console.info("updated intercom from intercom.tsx with userData as, ",t,n.toString());let r=localStorage.getItem("signup_source");if(r)try{Intercom("update",{signup_source:r}),console.info("updated signup source as, ",r,n.toString())}catch(o){console.error("Error updating signup source on intercom",o)}}function D(e,t){if(t){let n=Object.fromEntries(Object.entries(t).filter(([r,o])=>o!=null));Intercom("trackEvent",e,n)}else Intercom("trackEvent",e)}export{x as a,C as b,D as c};
